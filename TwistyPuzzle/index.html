<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=stylesheet  href="https://apj.hgreer.com/blog"> <link rel=icon  href="/assets/favicon.png"> <script> fetch("https://apj.hgreer.com/referrer?" + document.referrer); </script> <title></title> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/FeatureMapICON/">Feature Map Inverse Consistency</a> --> <li><a href="/HatTile/">Aperiodic Tiling with Z3</a> <!-- <li><a href="/ICON/">Inverse Consistent Regstration</a> <li><a href="/Mandelbrot/">Mandelbrot Set Adventures</a> --> <li><a href="/JavascriptMandelbrot/">Mandelbrot Set</a> <li><a href="/TrebuchetSimulator/">Trebuchet Simulator</a> <li><a href="/BadMatrixMultiply/">Bad Matrix Multiplication</a> <li><a href="/TwistyPuzzle/">Twisty Puzzles</a> <li><a href="/GameJam/">Game Jam Games</a> <li><a href="/menu3/">Tags</a> </ul> </div> <div id=main > <div class=franklin-content ><img src="/assets/TwistyPuzzle/code/header.png" alt=""> <p>The in browser, playable rubiks cubes, including a pyraminx and a face turing octahedron, are currently hosted <a href="http://cubes.hgreer.com">here</a>. Hopefully this post will eventually get to explaining how they work</p> <p>Rubiks cubes are fascinating, and I&#39;ve been working on writing a post about solving them for a while. At first, I thought that the post would be about solving them, and the draft of that post is at &#40;link&#41; but I quickly realized that the post about solving them needed playable, embedded widgets where the reader could try the techniques in question. </p> <pre><code class="plaintext hljs">PyObject &lt;module &#x27;scipy&#x27; from &#x27;/opt/hostedtoolcache/Python/3.10.18/x64/lib/python3.10/site-packages/scipy/__init__.py&#x27;&gt;</code></pre>
<p><a href=SolveARubiksCubeWithoutMemorization.md >The unfinishable post in question</a></p>
<p>Thus, this post started, a prequel of sorts, about how to embed a twisty cube widget in a website. It becomes a bit of a journey.</p>
<p>I started off implementing a copy of Simon Tatham&#39;s &quot;Twiddle&quot;, which is a simplified puzzle with rubiks like motion. Instead of stickers on cublets, it just has 16 tiles in a square, with the ability to turn 3x3 sub-sets of the puzzle by 90 degrees. I elected to represent the state of the puzzle and the moves as 16 x 16 permutation matrices. Then, I could apply a move  by simply multiplying it with the state. Render the puzzle by multiplying the state with a &quot;piece location&quot; matrix. </p>
<pre><code class="julia hljs"><span class=hljs-keyword >import</span> numpy as np
<span class=hljs-keyword >import</span> matplotlib.pyplot as plt
<span class=hljs-keyword >import</span> sys
state = np.eye(<span class=hljs-number >16</span>)
display_matrix = []
<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> range(<span class=hljs-number >4</span>):
  <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> range(<span class=hljs-number >4</span>):
    display_matrix.append([j, -i])
display_matrix = np.array(display_matrix) - np.mean(display_matrix, axis=<span class=hljs-number >0</span>, keepdims=True)
def show(state):
  [plt.text(x, y, str(i), ha=&#x27;center&#x27;, va=&#x27;center&#x27;, fontsize=<span class=hljs-number >16</span>)
   <span class=hljs-keyword >for</span> i, (x, y) <span class=hljs-keyword >in</span> enumerate(state @ display_matrix / <span class=hljs-number >5</span> + <span class=hljs-number >.5</span>)]
show(state)</code></pre>
<img src="/assets/TwistyPuzzle/code/output/board.png" alt="">
<p>For a start, we just hand write the permutation for a single move</p>
<pre><code class="julia hljs">move = (np.
array([[<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>, <span class=hljs-number >0.</span>],
       [<span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >0.</span>, <span class=hljs-number >1.</span>]]))
show(move @ state)</code></pre>
<img src="/assets/TwistyPuzzle/code/output/boardTwisted.png" alt="">
<p>This successfully twisted the top left square&#33; </p>
<p>This is where the magic starts, and the justification arrives for representing moves via matrices. How are  we going to animate this move? Easy&#33; if we want the move to take 2 frames, we just take the square root of move&#33; </p>
<pre><code class="julia hljs">from scipy.linalg <span class=hljs-keyword >import</span> logm, expm
show(expm(logm(move) / <span class=hljs-number >2</span>) @ state)</code></pre>
<img src="/assets/TwistyPuzzle/code/output/boardroot.png" alt="">
<p>This works for any fraction of a turn we want, allowing easy smooth animation of any permutation.</p>
<p>Now, writing out that matrix <code>move</code> sucked, and it&#39;s only going to get worse to do manually as we scale up the sticker count: Instead, lets let a computer find it&#33;</p>
<p>The plan is to create a general function that takes a set of points &#40;such as the one in our display matrix, or a subset corresponding to a move&#41; and returns all the possible rotations of the the points that correspond to permutations of the points, by finding all solutions to </p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>D</mi><mi>Q</mi><mo>=</mo><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex"> DQ = AD </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">Q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span></span>
<p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is the display matrix we computed earlier, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> is a permutation, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">Q</span></span></span></span> is a physical rotation. </p>
<p>This can be done efficiently by a backtracking solve. Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> be a prefix matrix, like </p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>P</mi><mn>5</mn></msub><mo>=</mo><mrow><mo fence=true >(</mo><mtable rowspacing=0.1600em  columnalign="center center center center center center center center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >)</mo></mrow></mrow><annotation encoding="application/x-tex"> P_5 = 
\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0  &amp; ...\\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0
\end{pmatrix}
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:6.00008em;vertical-align:-2.75004em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.25004em;"><span style="top:-2.31102em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-3.45802em;"><span class=pstrut  style="height:4.41604em;"></span><span style="height:2.4160399999999997em;width:0.875em;"><svg width='0.875em' height='2.4160399999999997em' style='width:0.875em' viewBox='0 0 875 2416' preserveAspectRatio='xMinYMin'><path d='M291 0 H417 V2416 H291z M291 0 H417 V2416 H291z'/></svg></span></span><span style="top:-6.511079999999999em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.75004em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.2500000000000004em;"><span style="top:-5.410000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-3.01em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-1.8099999999999998em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-0.6099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8500000000000003em;"><span style="top:-3.0100000000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >...</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.3499999999999998em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.25004em;"><span style="top:-2.31102em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-3.45802em;"><span class=pstrut  style="height:4.41604em;"></span><span style="height:2.4160399999999997em;width:0.875em;"><svg width='0.875em' height='2.4160399999999997em' style='width:0.875em' viewBox='0 0 875 2416' preserveAspectRatio='xMinYMin'><path d='M457 0 H583 V2416 H457z M457 0 H583 V2416 H457z'/></svg></span></span><span style="top:-6.511079999999999em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.75004em;"><span></span></span></span></span></span></span></span></span></span></span></span>
<p>Think of this as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>5</mn></msub><mi>A</mi></mrow><annotation encoding="application/x-tex">P_5A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span> takes the first 5 rows of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span></p>
<p>Then, if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>Q</mi><mo>=</mo><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">DQ = AD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">Q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>, we know that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>D</mi><mi>Q</mi><mo>=</mo><mi>P</mi><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">PDQ = PAD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">Q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span></p>
<p>By contrapositive, if there are no solutions Q to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>D</mi><mi>Q</mi><mo>=</mo><mi>P</mi><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">PDQ = PAD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">Q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>, there are no solutions to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>Q</mi><mo>=</mo><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">DQ = AD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">Q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span></p>
<p>This lets us use a standard recursive iterator through all permutations, but with pruning whenever <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>D</mi><mi>Q</mi><mo>=</mo><mi>P</mi><mi>A</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">PDQ = PAD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">Q</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is unsolvable.</p>
<pre><code class="julia hljs">def DQ_AD_solve(D):
    eye = np.eye(len(D))

    def feasible(permutation_so_far):
        <span class=hljs-keyword >if</span> ( np.abs(np.linalg.norm(D[len(permutation_so_far) - <span class=hljs-number >1</span>]) - np.linalg.norm(D[permutation_so_far[-<span class=hljs-number >1</span>]])) &gt; <span class=hljs-number >0.001</span>):
            <span class=hljs-keyword >return</span> False
        P = eye[: len(permutation_so_far)]
        PA = eye[permutation_so_far]
        Q, residuals, _rank, _singular_values = np.linalg.lstsq(P<span class=hljs-meta >@D</span>, PA<span class=hljs-meta >@D</span>)

        <span class=hljs-keyword >if</span> np.abs(np.linalg.det(Q) + <span class=hljs-number >1</span>) &lt; <span class=hljs-number >.001</span>:
            <span class=hljs-keyword >return</span> False

        <span class=hljs-keyword >if</span> len(permutation_so_far) == len(D):
            permutations.append(PA)
            rotations.append(Q)
            <span class=hljs-keyword >return</span> False

        <span class=hljs-keyword >return</span> len(residuals) == <span class=hljs-number >0</span> or (np.max(np.abs(residuals)) &lt; <span class=hljs-number >0.0001</span>).item()

    def recursive_permutations(permutation_so_far):
        <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> range(len(D)):
            <span class=hljs-keyword >if</span> not i <span class=hljs-keyword >in</span> permutation_so_far:
                continuation = permutation_so_far + [i]
                <span class=hljs-keyword >if</span> feasible(continuation):
                    recursive_permutations(continuation)

    permutations = []
    rotations = []
    recursive_permutations([])
    <span class=hljs-keyword >return</span> permutations, rotations
global_perms, global_rotations = DQ_AD_solve(display_matrix)
[print(np.argmax(perm, axis=<span class=hljs-number >0</span>)) <span class=hljs-keyword >for</span> perm <span class=hljs-keyword >in</span> global_perms]</code></pre><pre><code class="plaintext hljs">[ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15]
[12  8  4  0 13  9  5  1 14 10  6  2 15 11  7  3]
[ 3  7 11 15  2  6 10 14  1  5  9 13  0  4  8 12]
[15 14 13 12 11 10  9  8  7  6  5  4  3  2  1  0]
</code></pre>
<p>This <code>global_perms</code> array is super useful, because it not only gives all the moves that rotate the whole puzzle, it also gives all the sub-moves of the puzzle by computing <code>A @ move @ A.T</code> for all the symmetries A found by <code>DQ_AD_solve</code></p>
<pre><code class="julia hljs">frames = <span class=hljs-number >64</span>
<span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> range(frames):
    <span class=hljs-keyword >for</span> i, element <span class=hljs-keyword >in</span> enumerate(global_perms):
        plt.subplot(<span class=hljs-number >2</span>, <span class=hljs-number >2</span>, i + <span class=hljs-number >1</span>)
        show(expm(<span class=hljs-number >1</span>/<span class=hljs-number >16</span> * j * logm(element @ move @ element.T)))</code></pre>

<img src="/assets/TwistyPuzzle/code/output/all_move_animation.gif" alt="">
<p>Notice that we were able to combine 3 moves &#40;rotate the whole puzzle, turn a piece, then rotate the whole puzzle back&#41; and our animation approach fuses this into a single rotation.</p>
<p>In addition, for future puzzles, we won&#39;t need to write out <code>move</code> by hand: instead, we will take a subset of the display matrix corresponding to that part we want to rotate, and appy <code>DQ_AD_solve</code> to that.</p>
<p>That&#39;s enough to implement Twiddle&#33; There&#39;s an interactive version <a href="http://cubes.hgreer.com/">here</a>. For the interactive version, I swapped out the matplotlib display for pygame, and then threw it all into the browswer using Pyodide, which is a python interpreter &#40;with scipy, pygame, and numpy&#33;&#41; compiled to web assembly.</p>
<p>Next, it&#39;s time to move to the third dimension&#33; With the groundwork we&#39;ve laid, it&#39;s super easy.</p>
<p>We build a display matrix for a 3x3 rubiks cube, and record the colors of the permutable pieces since rubiks cube uses colors, not numbers.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >import</span> itertools
colors = []
display_matrix = []
<span class=hljs-keyword >for</span> sticker <span class=hljs-keyword >in</span> itertools.product(* [range(<span class=hljs-number >5</span>)] * <span class=hljs-number >3</span>):
    sticker = np.array(sticker)
    <span class=hljs-keyword >if</span> np.sum(sticker == <span class=hljs-number >0</span>) + np.sum(sticker == <span class=hljs-number >4</span>) == <span class=hljs-number >1</span>:
        colors.append(<span class=hljs-number >.5</span> + <span class=hljs-number >.5</span> * (<span class=hljs-number >0</span> - (sticker == <span class=hljs-number >0</span>) + (sticker == <span class=hljs-number >4</span>)))
        display_matrix.append(sticker)

display_matrix = np.array(display_matrix) - np.mean(np.array(display_matrix), axis=<span class=hljs-number >0</span>, keepdims=True)
colors = np.array(colors)

state = np.eye(<span class=hljs-number >54</span>)

def show(state):
    locations = state @ display_matrix
    fig, ax = plt.subplots(subplot_kw={<span class=hljs-string >&quot;projection&quot;</span>: <span class=hljs-string >&quot;3d&quot;</span>})
    ax.set_xlim(-<span class=hljs-number >2</span>, <span class=hljs-number >2</span>)
    ax.set_ylim(-<span class=hljs-number >2</span>, <span class=hljs-number >2</span>)
    ax.set_zlim(-<span class=hljs-number >2</span>, <span class=hljs-number >2</span>)
    ax.scatter(locations[:, <span class=hljs-number >0</span>], locations[:, <span class=hljs-number >1</span>], locations[:, <span class=hljs-number >2</span>], c=colors, s=<span class=hljs-number >800</span>, alpha=<span class=hljs-number >1</span>)
show(state)</code></pre>
<img src="/assets/TwistyPuzzle/code/output/rubiks.png" alt="">
<p>I use the global permutations to rotate the cube along any of its axes</p>
<pre><code class="julia hljs">global_perms, global_rotations = DQ_AD_solve(display_matrix)

<span class=hljs-keyword >for</span> i, element <span class=hljs-keyword >in</span> enumerate([<span class=hljs-number >1</span>, <span class=hljs-number >12</span>, <span class=hljs-number >4</span>, <span class=hljs-number >9</span>]):
        element = global_perms[element]
        <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> range(frames // <span class=hljs-number >4</span>):
            state = state<span class=hljs-meta >@expm</span>(<span class=hljs-number >1</span>/<span class=hljs-number >16</span> * logm(element))
            show(np.real(state))</code></pre>
<img src="/assets/TwistyPuzzle/code/output/rubiks_rotate_animation.gif" alt="">
<p>And I use the permutations of a subset of the cube to rotate a single slice. As before, we compute a single &quot;move&quot; permutation, and then get all the moves via matricies of the form element @ move @ element.T</p>
<pre><code class="julia hljs">slice_perms, slice_rotations = DQ_AD_solve(display_matrix[:<span class=hljs-number >21</span>])
move = np.eye(<span class=hljs-number >54</span>)
move[:<span class=hljs-number >21</span>, :<span class=hljs-number >21</span>] = slice_perms[<span class=hljs-number >1</span>]

<span class=hljs-keyword >for</span> i, element <span class=hljs-keyword >in</span> enumerate([<span class=hljs-number >1</span>, <span class=hljs-number >3</span>, <span class=hljs-number >4</span>, <span class=hljs-number >9</span>]):
        element = global_perms[element]
        <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> range(frames // <span class=hljs-number >4</span>):
            state = state<span class=hljs-meta >@expm</span>(<span class=hljs-number >1</span>/<span class=hljs-number >16</span> * logm(element @ move @ element.T))
            show(np.real(state))</code></pre>
<img src="/assets/TwistyPuzzle/code/output/rubiks_slice_rotate_animation.gif" alt="">
<p>The playable version of this rubiks cube is <a href="http://cubes.hgreer.com/rubiks">here</a></p>
<p>Now, this is a standard rubiks cube. If we want to get a variant, it&#39;s as simple as selecting a different subset of the points to be the turnable slice.</p>
<pre><code class="julia hljs">re_order = np.argsort(np.sum(display_matrix, axis=<span class=hljs-number >1</span>))

display_matrix = display_matrix[re_order]

colors = colors[re_order]

state = np.eye(<span class=hljs-number >54</span>)

global_perms, global_rotations = DQ_AD_solve(display_matrix)

slice_perms, slice_rotations = DQ_AD_solve((display_matrix)[:<span class=hljs-number >18</span>])
move = np.eye(<span class=hljs-number >54</span>)
move[:<span class=hljs-number >18</span>, :<span class=hljs-number >18</span>] = slice_perms[<span class=hljs-number >1</span>]

<span class=hljs-keyword >for</span> i, element <span class=hljs-keyword >in</span> enumerate([<span class=hljs-number >1</span>, <span class=hljs-number >3</span>, <span class=hljs-number >4</span>, <span class=hljs-number >9</span>]):
        element = global_perms[element]
        <span class=hljs-keyword >for</span> j <span class=hljs-keyword >in</span> range(frames // <span class=hljs-number >4</span>):
            state = state<span class=hljs-meta >@expm</span>(<span class=hljs-number >1</span>/<span class=hljs-number >16</span> * logm(element @ move @ element.T))
            show(np.real(state))</code></pre>
<img src="/assets/TwistyPuzzle/code/output/rubiks_corner_rotate_animation.gif" alt="">


<div class=page-foot >
  <div>
    <a href=https://subdavis.com>subdavis.com </a> 
    <a href=http://forrestli.con>forrestli.com</a>
  <div class=copyright >
    &copy; Hastings Greer. Last modified: August 31, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
        </div> 
    </div>