<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=stylesheet  href="https://apj.hgreer.com/blog"> <link rel=icon  href="/assets/favicon.png"> <title>Jan252024</title> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/FeatureMapICON/">Feature Map Inverse Consistency</a> --> <li><a href="/HatTile/">Aperiodic Tiling with Z3</a> <!-- <li><a href="/ICON/">Inverse Consistent Regstration</a> <li><a href="/Mandelbrot/">Mandelbrot Set Adventures</a> --> <li><a href="/JavascriptMandelbrot/">Mandelbrot Set</a> <li><a href="/TrebuchetSimulator/">Trebuchet Simulator</a> <li><a href="/BadMatrixMultiply/">Bad Matrix Multiplication</a> <li><a href="/GameJam/">Game Jam Games</a> <li><a href="/menu3/">Tags</a> </ul> </div> <div id=main > <div class=franklin-content ><h2 id=questions ><a href="#questions" class=header-anchor >Questions</a></h2> <p>paternity leave</p> <h2 id=itk_wrapping_of_icon_is_done_and_im_pretty_pleased_with_it ><a href="#itk_wrapping_of_icon_is_done_and_im_pretty_pleased_with_it" class=header-anchor >ITK wrapping of ICON is done and I&#39;m pretty pleased with it</a></h2> <p>Two problems were cleared up: No way to register itkImage&lt;Vector&gt; with python&#39;s garbage collector, caused intermittent segfaults. I have a temporary solution that just permanently leaks the memory, Dzenan at Kitware is working on a permanent fix</p> <p>Also, need to make sure that the numpy array that you are constructing the image with is contiguous: otherwise, this hits a bug in itk&#39;s ImageViewFromArray and causes further intermittent segfaults I have a pull request awaiting merger into ITK that fixes this issue.</p> <p>Overall, using ITK for representing deformable transforms in a portable way has been a pain, but it is done, and after the pull requests in itk are cleared, it will be much easier for the other students in the group: They can just pip install ICON and use </p> <pre><code class="julia hljs">icon_registration.itk_wrapper.create_itk_transform</code></pre>
<p>Also, ICON now does inference just fine on CPU: takes about 40 seconds for a single pair. This should be pleasing to Serena&#33;</p>
<h2 id=code_links ><a href="#code_links" class=header-anchor >Code links</a></h2>
<p><a href="https://github.com/InsightSoftwareConsortium/ITK/issues/3130">ITK issue from when I started getting segfaults</a></p>
<p><a href="https://github.com/InsightSoftwareConsortium/ITK/pull/3140">ITK pull request to fix one kind of segfault</a></p>
<p><a href="https://github.com/InsightSoftwareConsortium/ITK/issues/3138">ITK issue to wrap DisplacementFieldTransform for VectorImage: this will fix all problems</a></p>
<p><a href="https://github.com/uncbiag/ICON/blob/master/src/icon_registration/itk_wrapper.py">Wrapper code in ICON</a></p>
<p><a href="https://colab.research.google.com/drive/1svftgw-vYWnLp9lSf3UkrG547atjbIrg?usp&#61;sharing">Demo notebook</a></p>
<h2 id=icon_applied_to_atlas_images ><a href="#icon_applied_to_atlas_images" class=header-anchor >ICON applied to atlas images</a></h2>
<p><a href="https://github.com/uncbiag/ICON_atlas/blob/master/atlas_registration.ipynb">notebook</a></p>
<p>It looks like for images with small affine component, performs well. Difficulty with zoomed knees.  Potential to use image spacing for improved performance?</p>

  <a href=/Reports/>Back to Reports</a>  
<div class=page-foot >
  <div>
    <a href=https://subdavis.com>subdavis.com </a> 
    <a href=http://forrestli.con>forrestli.com</a>
  <div class=copyright >
    &copy; Hastings Greer. Last modified: March 04, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
        </div> 
    </div>