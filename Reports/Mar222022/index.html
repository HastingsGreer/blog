<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=stylesheet  href="https://apj.hgreer.com/blog"> <link rel=icon  href="/assets/favicon.png"> <title>Early lung results and GradICON knee release</title> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/FeatureMapICON/">Feature Map Inverse Consistency</a> --> <li><a href="/HatTile/">Aperiodic Tiling with Z3</a> <!-- <li><a href="/ICON/">Inverse Consistent Regstration</a> <li><a href="/Mandelbrot/">Mandelbrot Set Adventures</a> --> <li><a href="/JavascriptMandelbrot/">Mandelbrot Set</a> <li><a href="/TrebuchetSimulator/">Trebuchet Simulator</a> <li><a href="/BadMatrixMultiply/">Bad Matrix Multiplication</a> <li><a href="/GameJam/">Game Jam Games</a> <li><a href="/menu3/">Tags</a> </ul> </div> <div id=main > <div class=franklin-content ><h2 id=knee ><a href="#knee" class=header-anchor >Knee:</a></h2> <p>GradICON medium resolution model released: <a href="https://github.com/uncbiag/ICON/pull/18">pull request</a></p> <p>Update icon<em>registration pip install icon</em>registration&#61;&#61;0.3.3 and switch to the new model #model &#61; pretrained<em>models.OAI</em>knees<em>registration</em>model&#40;&#41; model &#61; pretrained<em>models.OAI</em>knees<em>gradICON</em>model&#40;&#41; This release runs at half resolution just like the old model, with much fewer folds, better dice, and faster runtime: <a href="https://github.com/uncbiag/ICON/runs/5511035049?check_suite_focus&#61;true#step:6:89">action with results</a></p> <p>Let me know if you also want the full resolution model: it&#39;s not quite ready for release right now because it only runs on gpus with at least 20 GB of vram</p> <h2 id=lung ><a href="#lung" class=header-anchor >Lung:</a></h2> <p>Ideas attempted:</p> <p>Focus registration on lung instead of ribs</p> <ul> <li><p>only evaluate loss in lung region of moving image</p> <li><p>only evaluate loss in lung region of fixed image</p> <li><p>only evaluate loss in intersection of lung segmentations</p> <li><p>Zero image intensity outside of lung region</p> <li><p>Clip image intensity to <code>-1000, 0</code> before training ✅ </p> </ul> <p>Combat overfitting</p> <ul> <li><p>Warp both fixed and moving image with same linear transform</p> <li><p>Train on longitudinal as well as cross-subject pairs</p> <li><p>Warp both fixed and moving image with different linear transform ✅ </p> </ul> <p>Best &#40;bad&#41; result so far:</p> <pre><code class="julia hljs">mTRE: <span class=hljs-number >9.770269366339061</span>, mTRE_X: <span class=hljs-number >2.2851461818021503</span>, mTRE_Y: <span class=hljs-number >6.378642569335982</span>, mTRE_Z: <span class=hljs-number >5.522105794414662</span>, DICE: <span class=hljs-number >0.9608421929940194</span>
mTRE: <span class=hljs-number >7.972476933755549</span>, mTRE_X: <span class=hljs-number >2.5015854799159594</span>, mTRE_Y: <span class=hljs-number >4.762276590067334</span>, mTRE_Z: <span class=hljs-number >4.4913444717735675</span>, DICE: <span class=hljs-number >0.9781910842486858</span></code></pre> <p>Ideas not tested yet:</p> <ul> <li><p>LNCC</p> <li><p>Bring Lin&#39;s architecture forward</p> <li><p>Do highest resolution training</p> <li><p>Do overfit</p> </ul> <p><a href="https://github.com/HastingsGreer/ICON_lung/blob/similarity_in_lung/notebooks/eval_dirlab.ipynb">notebook</a></p> <h2 id=brain ><a href="#brain" class=header-anchor >Brain</a></h2> <p>Task for marc: fix permissions on test set?</p> <p>Training setup:</p> <p>2 trainings currently in flight. </p> <p>Both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mi mathvariant=normal >.</mi><mn>05</mn></mrow><annotation encoding="application/x-tex">\lambda = .05</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">λ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >.05</span></span></span></span></p> <p>Both skull stripped</p> <p>one at half res, the other progressive starting with quarter res.</p> <p><a href="https://github.com/HastingsGreer/InverseConsistency/blob/brain/notebooks/brain.ipynb">notebook</a></p> <p>Only visual results so far- evaluate with me?</p> <p>TODO:</p> <ul> <li><p>Evaluate on MindBoggle101 </p> <li><p>Evaluate on LPBA40</p> <li><p>Just do the quicksilver evaluation</p> </ul> <h1 id=icon_library_tutorial ><a href="#icon_library_tutorial" class=header-anchor >ICON library tutorial</a></h1> <p>Working on an ICON library tutorial <a href="/ICON_SVF_tutorial">here</a></p> <h1 id=transformer_compatible_with_gradicon_loss ><a href="#transformer_compatible_with_gradicon_loss" class=header-anchor >Transformer compatible with GradICON loss?</a></h1> <p>Not as far as I can tell</p> <h1 id=theory_todo ><a href="#theory_todo" class=header-anchor >Theory TODO</a></h1> <ul> <li><p>Hessian of loss</p> <li><p>1-D experiment</p> <li><p>fewer or more samples</p> <li><p>ICON without gradicon, but with loss barrier around <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∣</mi><mi>J</mi><mi mathvariant=normal >∣</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">|J| = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >∣</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class=mord >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span></p> <li><p>optimization without network</p> </ul> <a href=/Reports/>Back to Reports</a> <div class=page-foot > <div> <a href=https://subdavis.com>subdavis.com </a> <a href=http://forrestli.con>forrestli.com</a> <div class=copyright > &copy; Hastings Greer. Last modified: February 18, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> </div>