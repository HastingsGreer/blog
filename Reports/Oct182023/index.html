<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=stylesheet  href="https://apj.hgreer.com/blog"> <link rel=icon  href="/assets/favicon.png"> <title>Working equivariant registration</title> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/FeatureMapICON/">Feature Map Inverse Consistency</a> --> <li><a href="/HatTile/">Aperiodic Tiling with Z3</a> <!-- <li><a href="/ICON/">Inverse Consistent Regstration</a> <li><a href="/Mandelbrot/">Mandelbrot Set Adventures</a> --> <li><a href="/JavascriptMandelbrot/">Mandelbrot Set</a> <li><a href="/TrebuchetSimulator/">Trebuchet Simulator</a> <li><a href="/BadMatrixMultiply/">Bad Matrix Multiplication</a> <li><a href="/GameJam/">Game Jam Games</a> <li><a href="/menu3/">Tags</a> </ul> </div> <div id=main > <div class=franklin-content ><h1 id=performance_results_first ><a href="#performance_results_first" class=header-anchor >Performance results first</a></h1> <p>GradICON, Constricon can do a great job solving the challenging retina registration problem. &#40;Here we use the Constricon approach&#41;</p> <p>Constricon:</p> <img src="/assets/Reports/Oct182023/code/constricon_noshift.png" alt=""> <p>In the event that the moving and fixed images are misaligned by a constant shift, ConstrICON can manage it with careful hyperparameter settings</p> <img src="/assets/Reports/Oct182023/code/constricon_shift.png" alt=""> <p>Where GradICON just fails</p> <img src="/assets/Reports/Oct182023/code/gradicon_shift.png" alt=""> <p>The new equivariant architecture can&#39;t see the shift, so it works fine whether or not the images are shifted</p> <img src="/assets/Reports/Oct182023/code/equicon_noshift.png" alt=""> <img src="/assets/Reports/Oct182023/code/equicon_shift.png" alt=""> <h1 id=equivariant_architecture_details ><a href="#equivariant_architecture_details" class=header-anchor >Equivariant architecture details</a></h1> <p>For the first breakthrough, we need to cover a proof first.</p> <p>Assertion: if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Φ</mi></mrow><annotation encoding="application/x-tex">\Phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >Φ</span></span></span></span> is equivariant to transforming <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>I</mi><mi>A</mi></msup><mo separator=true >,</mo><msup><mi>I</mi><mi>B</mi></msup><mo>→</mo><msup><mi>I</mi><mi>A</mi></msup><mo>∘</mo><mi>W</mi><mo separator=true >,</mo><msup><mi>I</mi><mi>B</mi></msup><mo>∘</mo><mi>U</mi></mrow><annotation encoding="application/x-tex">I^A, I^B \rightarrow I^A \circ W, I^B \circ U</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.035771em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8413309999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span> &#40;henceforth &#91;W, U&#93; equivariant&#41; and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >Ψ</mi></mrow><annotation encoding="application/x-tex">\Psi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >Ψ</span></span></span></span> is equivariant to transforming <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>I</mi><mi>A</mi></msup><mo separator=true >,</mo><msup><mi>I</mi><mi>B</mi></msup><mo>→</mo><msup><mi>I</mi><mi>A</mi></msup><mo>∘</mo><mi>U</mi><mo separator=true >,</mo><msup><mi>I</mi><mi>B</mi></msup><mo>∘</mo><mi>U</mi></mrow><annotation encoding="application/x-tex">I^A, I^B \rightarrow I^A \circ U, I^B \circ U</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.035771em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8413309999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.035771em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span> &#40;henceforth &#91;U, U&#93; equivariant&#41; for U and W from a class of transforms <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=script >T</mi></mrow><annotation encoding="application/x-tex">\mathcal{T}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathcal" style="margin-right:0.25417em;">T</span></span></span></span>, then <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>w</mi><mi>o</mi><mi>S</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo stretchy=false >{</mo><mi mathvariant=normal >Φ</mi><mo separator=true >,</mo><mi mathvariant=normal >Ψ</mi><mo stretchy=false >}</mo></mrow><annotation encoding="application/x-tex">TwoStep\{\Phi, \Psi\}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">Tw</span><span class="mord mathnormal">o</span><span class="mord mathnormal">St</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class=mopen >{</span><span class=mord >Φ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >Ψ</span><span class=mclose >}</span></span></span></span> is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mi>W</mi><mo separator=true >,</mo><mi>U</mi><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">[W, U]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mclose >]</span></span></span></span> equivariant</p> <p>Proof:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mi>T</mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mi>w</mi><mi>o</mi><mi>S</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo stretchy=false >{</mo><mi mathvariant=normal >Φ</mi><mo separator=true >,</mo><mi mathvariant=normal >Ψ</mi><mo stretchy=false >}</mo><mo stretchy=false >[</mo><mi>A</mi><mo>∘</mo><mi>W</mi><mo separator=true >,</mo><mi>B</mi><mo>∘</mo><mi>U</mi><mo stretchy=false >]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo>∘</mo><mi>W</mi><mo separator=true >,</mo><mi>B</mi><mo>∘</mo><mi>U</mi><mo stretchy=false >]</mo><mo>∘</mo><mi mathvariant=normal >Ψ</mi><mrow><mo fence=true >[</mo><mi>A</mi><mo>∘</mo><mi>W</mi><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo>∘</mo><mi>W</mi><mo separator=true >,</mo><mi>B</mi><mo>∘</mo><mi>U</mi><mo stretchy=false >]</mo><mo separator=true >,</mo><mi>B</mi><mo>∘</mo><mi>U</mi><mo fence=true >]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msup><mi>W</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi>U</mi><mo>∘</mo><mi mathvariant=normal >Ψ</mi><mrow><mo fence=true >[</mo><mi>A</mi><mo>∘</mo><mi>W</mi><mo>∘</mo><msup><mi>W</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi>U</mi><mo separator=true >,</mo><mi>B</mi><mo>∘</mo><mi>U</mi><mo fence=true >]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msup><mi>W</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi>U</mi><mo>∘</mo><mi mathvariant=normal >Ψ</mi><mrow><mo fence=true >[</mo><mi>A</mi><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi>U</mi><mo separator=true >,</mo><mi>B</mi><mo>∘</mo><mi>U</mi><mo fence=true >]</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msup><mi>W</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi>U</mi><mo>∘</mo><msup><mi>U</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi mathvariant=normal >Ψ</mi><mrow><mo fence=true >[</mo><mi>A</mi><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo separator=true >,</mo><mi>B</mi><mo fence=true >]</mo></mrow><mo>∘</mo><mi>U</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msup><mi>W</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi mathvariant=normal >Ψ</mi><mrow><mo fence=true >[</mo><mi>A</mi><mo>∘</mo><mi mathvariant=normal >Φ</mi><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo separator=true >,</mo><mi>B</mi><mo fence=true >]</mo></mrow><mo>∘</mo><mi>U</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><msup><mi>W</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>∘</mo><mi>T</mi><mi>w</mi><mi>o</mi><mi>S</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo stretchy=false >{</mo><mi mathvariant=normal >Φ</mi><mo separator=true >,</mo><mi mathvariant=normal >Ψ</mi><mo stretchy=false >}</mo><mo stretchy=false >[</mo><mi>A</mi><mo separator=true >,</mo><mi>B</mi><mo stretchy=false >]</mo><mo>∘</mo><mi>U</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} T&amp;woStep\{\Phi, \Psi\}[A \circ W, B \circ U]\\ &amp;= \Phi[A \circ W, B \circ U] \circ \Psi\left[A \circ W \circ \Phi[A \circ W, B \circ U], B \circ U\right]\\ &amp;= W^{-1} \circ \Phi[A, B] \circ U \circ \Psi\left[A \circ W \circ W^{-1} \circ \Phi[A, B] \circ U, B \circ U\right] \\ &amp;= W^{-1} \circ \Phi[A, B] \circ U \circ \Psi\left[A \circ \Phi[A, B] \circ U, B \circ U\right] \\ &amp;= W^{-1} \circ \Phi[A, B] \circ U \circ U^{-1} \circ \Psi\left[A \circ \Phi[A, B], B\right] \circ U \\ &amp;= W^{-1} \circ \Phi[A, B] \circ \Psi\left[A \circ \Phi[A, B], B\right] \circ U \\ &amp;= W^{-1} \circ TwoStep\{\Phi, \Psi\}[A, B] \circ U \\ \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:10.620540000000002em;vertical-align:-5.060270000000001em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:5.56027em;"><span style="top:-7.72027em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span><span style="top:-6.220269999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span><span style="top:-4.696161999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span><span style="top:-3.1720539999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span><span style="top:-1.6479459999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span><span style="top:-0.12383799999999967em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span><span style="top:1.4002700000000008em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.060270000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:5.56027em;"><span style="top:-7.72027em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">o</span><span class="mord mathnormal">St</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class=mopen >{</span><span class=mord >Φ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >Ψ</span><span class=mclose >}</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mclose >]</span></span></span><span style="top:-6.220269999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Ψ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mclose >]</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose delimcenter" style="top:0em;">]</span></span></span></span><span style="top:-4.696161999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Ψ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span><span style="top:-3.1720539999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Ψ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mclose delimcenter" style="top:0em;">]</span></span></span></span><span style="top:-1.6479459999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Ψ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:-0.12383799999999967em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Ψ</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >Φ</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span><span style="top:1.4002700000000008em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">Tw</span><span class="mord mathnormal">o</span><span class="mord mathnormal">St</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class=mopen >{</span><span class=mord >Φ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >Ψ</span><span class=mclose >}</span><span class=mopen >[</span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∘</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.060270000000001em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>This allows the use of powerful but only &#91;U, U&#93; equivariant algorithms such as Voxelmorph-like approaches to be integrated into a &#91;W, U&#93; equivariant pipeline. </p> <p>For our registration approach, we will use </p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mi>T</mi><mi>w</mi><mi>o</mi><mi>S</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo stretchy=false >{</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mtext> </mtext><mi>T</mi><mi>w</mi><mi>o</mi><mi>S</mi><mi>t</mi><mi>e</mi><mi>p</mi><mo stretchy=false >{</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mtext> </mtext><mi>D</mi><mi>o</mi><mi>w</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=false >{</mo><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>n</mi><mi>t</mi><mi mathvariant=normal >_</mi><mi>r</mi><mi>e</mi><mi>g</mi><mo stretchy=false >}</mo><mo separator=true >,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mtext> </mtext><msub><mi mathvariant=normal >Ψ</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mtext> </mtext><mo stretchy=false >}</mo><mo separator=true >,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mtext> </mtext><msub><mi mathvariant=normal >Ψ</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo stretchy=false >}</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} &amp;TwoStep\{\\ &amp;~~	TwoStep\{ \\ &amp;~~~~ DownsampleRegistration\{Equivariant\_reg\},\\ &amp;~~~~ \Psi_1\\ &amp;~~ \},\\ &amp;~~ \Psi_2\\ &amp;\}\\ \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:10.500000000000004em;vertical-align:-5.000000000000002em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:5.500000000000001em;"><span style="top:-7.500000000000001em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span><span style="top:-6em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span><span style="top:-4.499999999999999em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span><span style="top:-2.999999999999999em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span><span style="top:-1.4999999999999991em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span><span style="top:1.7763568394002505e-15em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span><span style="top:1.5000000000000018em;"><span class=pstrut  style="height:2.84em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.000000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:5.500000000000001em;"><span style="top:-7.660000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mord mathnormal" style="margin-right:0.02691em;">Tw</span><span class="mord mathnormal">o</span><span class="mord mathnormal">St</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class=mopen >{</span></span></span><span style="top:-6.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord mathnormal" style="margin-right:0.02691em;">Tw</span><span class="mord mathnormal">o</span><span class="mord mathnormal">St</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class=mopen >{</span></span></span><span style="top:-4.659999999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mord mathnormal">Do</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">am</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class=mopen >{</span><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">ian</span><span class="mord mathnormal">t</span><span class=mord  style="margin-right:0.02778em;">_</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=mclose >}</span><span class=mpunct >,</span></span></span><span style="top:-3.1599999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >Ψ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.6599999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class=mclose >}</span><span class=mpunct >,</span></span></span><span style="top:-0.15999999999999837em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class="mspace nobreak"> </span><span class="mspace nobreak"> </span><span class=mord ><span class=mord >Ψ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:1.3400000000000016em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mclose >}</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.000000000000002em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant=normal >Ψ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\Psi_i</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class=mord >Ψ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> are standard registration U-Nets that are naturally &#91;U, U&#93; equivariant.</p> <h1 id=tuning_details ><a href="#tuning_details" class=header-anchor >Tuning details</a></h1> <p>For this experiment, we target &#91;W, U&#93; translation equivariance.</p> <p>To make this train end to end, we made several fine adjustments to equivariant&#95;reg.</p> <ol> <li><p>We normalize the feature vectors before passing to the attention layer, and then scale by 4.</p> <li><p>We use a simple convolutional network for featurizing with residual connections and no downsampling. We pad the image before processing, and crop afterwards, to remove boundary effects. This is exactly translation equivariant to 1 pixel shifts.</p> <li><p>We add batch normalization to the feature extraction network.</p> <li><p>We use diffusion regularization on the end to end registration pipeline. GradICON or bending energy regularization work for fine tuning, but require student-teacher initialization and cannot train from scratch. For medical images, it is very important to simplify the training process, so eliminating the student-teacher initialization is a massive win.</p> <li><p>We use 128 dimensional feature vectors. 64 dimensions is too little.</p> </ol> <h1 id=notebooks ><a href="#notebooks" class=header-anchor >Notebooks</a></h1> <p><a href="/assets/Reports/Oct182023/code/constricon_noshift.html">constricon_noshift</a> <a href="/assets/Reports/Oct182023/code/constricon_shift.html">constricon_shift</a> <a href="/assets/Reports/Oct182023/code/gradicon_shift.html">gradicon_shift</a> <a href="/assets/Reports/Oct182023/code/equicon_noshift.html">equicon_noshift</a> <a href="/assets/Reports/Oct182024/code/equicon_shift.html">equicon_shift</a></p> <a href=/Reports/>Back to Reports</a> <div class=page-foot > <div> <a href=https://subdavis.com>subdavis.com </a> <a href=http://forrestli.con>forrestli.com</a> <div class=copyright > &copy; Hastings Greer. Last modified: February 24, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> </div>