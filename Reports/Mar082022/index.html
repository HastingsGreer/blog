<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/tufte.css"> <link rel=stylesheet  href="/css/latex.css"> <link rel=stylesheet  href="/css/adjust.css"> <link rel=icon  href="/assets/favicon.png"> <title>Mar08</title> <div id=layout > <div id=menu > <ul> <li><a href="/">Home</a> <!-- <li><a href="/FeatureMapICON/">Feature Map Inverse Consistency</a> --> <li><a href="/ICON/">Inverse Consistent Regstration</a> <li><a href="/Mandelbrot/">Mandelbrot Set Adventures</a> <li><a href="/BadMatrixMultiply/">Bad Matrix Multiplication</a> <li><a href="/GameJam/">Game Jam Games</a> <li><a href="/menu3/">Tags</a> </ul> </div> <div id=main > <div class=franklin-content ><h1 id=march_8_progress ><a href="#march_8_progress" class=header-anchor >March 8 progress:</a></h1> <h1 id=gradicon_lung_registration ><a href="#gradicon_lung_registration" class=header-anchor >GradICON Lung registration</a></h1> <p>preliminary network trained on lung dataset. Performance is mediocre, but I am still learning about this modality.</p> <img src="/assets/Reports/Mar082022/code/lung_A.png" alt=""> <img src="/assets/Reports/Mar082022/code/lung_B.png" alt=""> <img src="/assets/Reports/Mar082022/code/lung_warped_A.png" alt=""> <p><a href="https://github.com/HastingsGreer/ICON_lung/blob/master/notebooks/medres_eval.ipynb">notebook</a></p> <p>We get aroung a DICE of 97 for lung vs not-lung which is worse than Lin&#39;s ~98.5</p> <p>We are working on landmark code.</p> <p>Issue 1: Dataset is badly prepared. This is a bug in my code, need to document and fix</p> <p>Issue 2: Overfitting. Solution: augment by using cross sample warping?</p> <p>Question from zhenyang: should we be segmenting the lung and only registering inside it, like done with skull stripping? </p> <p>Question from Hastings: where is the full resolution data? It is my white whale at this point</p> <h1 id=gradicon_knee_registration ><a href="#gradicon_knee_registration" class=header-anchor >GradICON Knee registration</a></h1> <p>test performance plateued at dice 74.5. Very nice&#33;</p> <h1 id=gradicon_affine_registration ><a href="#gradicon_affine_registration" class=header-anchor >GradICON affine registration</a></h1> <p>Some unusual outcomes to experiments: in 2-D, intuitively should do affine then deformable registration, but in some circumstances doing deformable then affine performs better? <a href="https://colab.research.google.com/drive/1rFWGIkEN_K8VEHkov1LloC16cvnR3BQw?usp&#61;sharing">notebook</a></p> <h1 id=icon_library_tutorial ><a href="#icon_library_tutorial" class=header-anchor >ICON library tutorial</a></h1> <p>Working on an ICON library tutorial <a href="/ICON_SVF_tutorial">here</a></p> <h1 id=notes ><a href="#notes" class=header-anchor >Notes</a></h1> <p>medical imaging decathlon <a href="http://medicaldecathlon.com/">lonk</a></p> <p>TODO from beginning of week:</p> <p>release GradICON on pip deploy GradICON full res and half res models to <code>icon_registration.pretrained_models</code></p> <p>Lung registration</p> <p>Path of High resolution data:</p> <p>/playpen-raid1/lin.tian/data/raw/DIRLABCasesHighRes</p> <p>Path of annotations: </p> <p>/playpen-raid1/zyshen/lung<em>reg/evaluate/dirlab</em>landmarks</p> <p>Lin Tian algorithm for registering landmarks, original images:</p> <pre><code class="julia hljs"><span class=hljs-comment ># Pad the one with smaller size</span>
        pad_size = ori_target.shape[<span class=hljs-number >0</span>] - ori_source.shape[<span class=hljs-number >0</span>]
        <span class=hljs-keyword >if</span> pad_size &gt; <span class=hljs-number >0</span>:
            ori_source = np.pad(ori_source, ((<span class=hljs-number >0</span>, pad_size), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>)), mode=&#x27;constant&#x27;, constant_values=-<span class=hljs-number >1024</span>)
            ori_source_seg = np.pad(ori_source_seg, ((<span class=hljs-number >0</span>, pad_size), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>)), mode=&#x27;constant&#x27;, constant_values=<span class=hljs-number >0</span>)
        <span class=hljs-keyword >else</span>:
            ori_target = np.pad(ori_target, ((<span class=hljs-number >0</span>, -pad_size), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>)), mode=&#x27;constant&#x27;, constant_values=-<span class=hljs-number >1024</span>)
            ori_target_seg = np.pad(ori_target_seg, ((<span class=hljs-number >0</span>, -pad_size), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>), (<span class=hljs-number >0</span>, <span class=hljs-number >0</span>)), mode=&#x27;constant&#x27;, constant_values=<span class=hljs-number >0</span>)</code></pre> <ul> <li><p>create training volume pyramid ☑️</p> <li><p>train network☑️</p> <li><ul> <li><p>get U-Net working on arbitrary sizes☑️</p> </ul> <li><ul> <li><p>or</p> </ul> <li><ul> <li><p>crop</p> </ul> <li><p>update train test split to match the dirlab cases&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;&#33;</p> <li><p>evaluate on dirlab</p> <li><ul> <li><p>Run Lintian&#39;s code</p> </ul> <li><ul> <li><ul> <li><p>get mermaid&#39;s pip installation fixed ☑️</p> </ul> </ul> <li><ul> <li><ul> <li><p>get icon_registration&#39;s pip installation fixed ☑️</p> </ul> </ul> </ul> <p>Monday Night task list</p> <ul> <li><p>Refresh preprocessing pipeling</p> <li><ul> <li><p>use footsteps for documenting progress</p> </ul> <li><ul> <li><p>fix intensity map </p> </ul> <li><ul> <li><p>fix train test split</p> </ul> </ul> <ul> <li><p>Train cross sample network</p> <li><p>Use cross sample network to augment for pairwise network</p> <li><p>Evaluate DICE using all pairs instead of only one</p> </ul> <p>- goal dice 98ish?</p> <ul> <li><p>Write presentation</p> </ul> <p>Find out more about evaluation process</p> <p>Brain registration</p> <ul> <li><p>pick a benchmark</p> </ul> <p>Atlas registration</p> <ul> <li><p>Try with GradICON</p> </ul> <p>Velocity Field in ICON☑️</p> <p>OAI pipeline 2&#39;</p> <ul> <li><p>make pip package</p> <li><p>fix cpu tests</p> </ul> <div class=page-foot > <div> <a href=https://subdavis.com>subdavis.com </a> <a href=http://forrestli.con>forrestli.com</a> <div class=copyright > &copy; Hastings Greer. Last modified: September 15, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> </div>